<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>محرك مقارنة الأسعار العربي</title>
<style>
body{font-family:Cairo,Arial;background:#0f172a;margin:0;color:#fff;text-align:center}
.container{max-width:1100px;margin:auto;padding:20px}
.title{font-size:34px;margin-bottom:25px;font-weight:bold;background:linear-gradient(45deg,#38bdf8,#22c55e);-webkit-background-clip:text;color:transparent}
.controls{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-bottom:25px}
select,input,button{padding:14px;border:none;border-radius:12px;font-size:16px;outline:none}
input{width:260px;background:#1e293b;color:white}
select{background:#1e293b;color:white}
button{background:#22c55e;color:white;cursor:pointer;transition:.3s;font-weight:bold}
button:hover{transform:scale(1.05);background:#16a34a}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:20px;margin-top:20px}
.card{background:#1e293b;border-radius:20px;padding:20px;transition:.35s;animation:fade .4s ease}
.card:hover{transform:translateY(-8px) scale(1.03);box-shadow:0 0 25px #22c55e66}
.store{font-size:20px;margin-bottom:15px}
.open{display:inline-block;padding:10px 20px;background:#22c55e;color:#fff;border-radius:10px;text-decoration:none;transition:.3s}
.open:hover{background:#15803d}
.loader{margin-top:30px;font-size:20px;opacity:.7}
@keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>
<div class="container">
<div class="title">محرك مقارنة الأسعار العربي</div>
<div class="controls">
<select id="country">
<option value="">اختر الدولة</option>
<option value="ma">المغرب</option>
<option value="dz">الجزائر</option>
<option value="tn">تونس</option>
<option value="eg">مصر</option>
<option value="sa">السعودية</option>
<option value="ae">الإمارات</option>
<option value="qa">قطر</option>
<option value="kw">الكويت</option>
<option value="bh">البحرين</option>
<option value="om">عمان</option>
<option value="iq">العراق</option>
<option value="jo">الأردن</option>
<option value="lb">لبنان</option>
<option value="ly">ليبيا</option>
<option value="sd">السودان</option>
<option value="ps">فلسطين</option>
<option value="sy">سوريا</option>
<option value="ye">اليمن</option>
<option value="mr">موريتانيا</option>
<option value="so">الصومال</option>
<option value="dj">جيبوتي</option>
<option value="km">جزر القمر</option>
</select>
<input id="search" placeholder="اكتب اسم المنتج">
<button onclick="searchProduct()">بحث</button>
</div>
<div id="results"></div>
</div>

<script>
async function searchProduct(){
const q=document.getElementById("search").value.trim();
const country=document.getElementById("country").value;
const box=document.getElementById("results");

if(!q||!country){alert("اختر الدولة واكتب المنتج");return;}

box.innerHTML="<div class='loader'>جاري البحث...</div>";

try{
let res=await fetch(`/api/price?q=${encodeURIComponent(q)}&country=${country}`);
let data=await res.json();
if(!data.length){box.innerHTML="لا توجد نتائج";return;}

let minPrice=Math.min(...data.map(p=>parseFloat(p.price.replace(/[^0-9.]/g,''))));
let html="<div class='grid'>";

data.forEach(p=>{
let cheapest=p.price.replace(/[^0-9.]/g,'')==minPrice?"<div style='position:absolute;top:10px;left:-30px;background:#22c55e;color:#fff;padding:5px 40px;transform:rotate(-45deg);font-size:13px'>الأرخص</div>":"";
html+=`<div class='card'>${cheapest}<img src='${p.image}'><div class='store'>${p.store}</div><div>${p.title}</div><div>${p.price}</div><a class='open' href='${p.link}' target='_blank'>شراء</a></div>`;
});

html+="</div>";
box.innerHTML=html;
}catch(e){box.innerHTML="خطأ في الاتصال بالسيرفر";}
}
</script>
</body>
</html>
